program Game;
uses crt, graph, FLIGHT, BLASTER;
const 
    StartBlX = 315;
    StartBlY = 357;
var
   flightArr: array[1..10] of TFlight;
   Blast : TShoot;
   g, h, e, amount: integer;
   StartPlX, StartPlY : Integer;
   StartPlX1, StartPlY1 : Integer;
   s : Char;
procedure ClearAll(count : Integer);
    var i : Integer;
begin
    for i := 1 to count do
    begin
        if ImgRight = nil then 
        flightArr[i].Clear(ImgLeft)
        else 
        flightArr[i].Clear(ImgRight);
    end;
end;

procedure BackGround;
begin
    setbkcolor(LightBlue);
    setcolor(1);
    setfillstyle(1,2);
    fillellipse(319,478,150,60);
    SetLineStyle(0,1,3);
    Line(0,419,679,419);
end;

procedure Run;
    var exitCondition: Boolean;
        GetStart, BoomCondition: Boolean;
        i, j: Integer;
begin
    exitCondition:= false;
    GetStart:= false;

    while not exitCondition do
     begin
        for i := 1 to amount do
        flightArr[i].Update;
  
        PutImage(x1, y1, Pict^, Normalput); 


        if keypressed then
        begin
            button:= readkey;
            if (button = #77) or (button = #75) or (button = #47) then
            Blast.Move(x1, y1, exitCondition)
            else
            begin
                if ( button = #32 ) and (GetStart = false) then
                begin
                    CircX:= x1 + 4;
                    CircY:= y1 + 6;
                    PutImage(CircX, CircY, ImgBullet^, XorPut);
                    GetStart:= true;
                end;
            end;
        end;


        if GetStart = true then
        begin
            PutImage(CircX, CircY, ImgBullet^, XorPut);
            CircY:= CircY - 15;
            PutImage(CircX, CircY, ImgBullet^, XorPut);
            BoomCondition:= Blast.Crossing(x, y, CircX, CircY, width, height, GetStart);
            if CircY - 15 <= 0 then
            begin
                GetStart:= false;
                PutImage(CircX, CircY, ImgBullet^, Xorput);                
            end;
            if (GetStart = false) and (BommCondition = false)  then 
            begin
                exitCondition:= true;
                PutImage(CircX, CircY, ImgBullet^, Xorput);
            end;
        end;

    ClearAll(amount);
    if exitCondition and (GetStart = false) then 
        begin
            OutTextXY(CircX, CircY, 'BOOOMM!!!');
        end;    
    end;
end;


begin
     g:= detect;
     initgraph(g,h,'');
     if e <> grOk then
WriteLn(GraphErrorMsg(e))
else
begin
    BackGround;

    randomize;
    StartPlX:= random(600);
    StartPlY:= random(200);
    flightArr[1].Init(StartPlX, StartPlY);
    Blast.Init;

    x1:= StartBlX - 100;
    y1:= StartBlY;


    amount:= 1;
    Run;



end;

     readln;
end.